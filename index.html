<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>WAFIShield | A two-layer, fully-extensible Python package for protecting LLM/agent apps against OWASP Top 10 and other evolving LLM vulnerabilities</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="WAFIShield" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A two-layer, fully-extensible Python package for protecting LLM/agent apps against OWASP Top 10 and other evolving LLM vulnerabilities" />
<meta property="og:description" content="A two-layer, fully-extensible Python package for protecting LLM/agent apps against OWASP Top 10 and other evolving LLM vulnerabilities" />
<meta property="og:site_name" content="WAFIShield" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="WAFIShield" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","description":"A two-layer, fully-extensible Python package for protecting LLM/agent apps against OWASP Top 10 and other evolving LLM vulnerabilities","headline":"WAFIShield","name":"WAFIShield","url":"/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=85dce181030e73119dda003153bb1b3cf18ed980">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">WAFIShield</h1>
      <h2 class="project-tagline">A two-layer, fully-extensible Python package for protecting LLM/agent apps against OWASP Top 10 and other evolving LLM vulnerabilities</h2>
      
        <a href="https://github.com/duestack/wafishield" class="btn">View on GitHub</a>
      
      
        <a href="https://github.com/duestack/wafishield/zipball/gh-pages" class="btn">Download .zip</a>
        <a href="https://github.com/duestack/wafishield/tarball/gh-pages" class="btn">Download .tar.gz</a>
      
    </header>

    <main id="content" class="main-content" role="main">
      <h1 id="wafishield">WAFIShield</h1>

<div align="center">
  <img src="assets/images/logo.png" alt="WAFIShield Logo" width="300" />
  <br />
  <h3>A two-layer, fully-extensible Python package for protecting LLM/agent apps against OWASP Top 10 and other evolving LLM vulnerabilities</h3>
</div>

<h2 id="️-disclaimer">⚠️ DISCLAIMER</h2>

<blockquote>
  <p><strong>WARNING</strong>: This package is under active development and is NOT READY FOR PRODUCTION USE. It is provided as-is without any guarantees or warranties. If you choose to use this package in a production environment, the developers and maintainers are not responsible for any issues, data breaches, security vulnerabilities, or any other problems that may arise. Use at your own risk.</p>
</blockquote>

<h2 id="overview">Overview</h2>

<p>WAFIShield provides a comprehensive security layer for your LLM applications, protecting against the OWASP Top 10 for LLMs and other evolving threats. It features:</p>

<ul>
  <li><strong>Rule-based filtering</strong>: Block malicious prompts using multilingual regex patterns</li>
  <li><strong>Smart sanitization</strong>: Redact sensitive PII and data before sending to LLMs</li>
  <li><strong>Secondary LLM evaluation</strong>: Use a second LLM to evaluate prompt/response safety</li>
  <li><strong>Full extensibility</strong>: Register custom rules, patterns, and system instructions</li>
  <li><strong>Observability</strong>: Metrics collection and integration with OpenTelemetry</li>
</ul>

<h2 id="installation">Installation</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Basic installation</span>
pip <span class="nb">install </span>wafishield

<span class="c"># With OpenAI integration</span>
pip <span class="nb">install </span>wafishield[openai]

<span class="c"># With all optional dependencies</span>
pip <span class="nb">install </span>wafishield[all]
</code></pre></div></div>

<h2 id="quick-start">Quick Start</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">wafishield</span> <span class="kn">import</span> <span class="n">WAFIShield</span>
<span class="kn">import</span> <span class="nn">openai</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Initialize WAFIShield
</span><span class="n">wafishield</span> <span class="o">=</span> <span class="n">WAFIShield</span><span class="p">(</span>
    <span class="n">llm_provider</span><span class="o">=</span><span class="s">"openai"</span><span class="p">,</span>
    <span class="n">llm_api_key</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"OPENAI_API_KEY"</span><span class="p">),</span>
    <span class="n">llm_model</span><span class="o">=</span><span class="s">"gpt-3.5-turbo"</span>
<span class="p">)</span>

<span class="c1"># Setup OpenAI client
</span><span class="n">openai</span><span class="p">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"OPENAI_API_KEY"</span><span class="p">)</span>

<span class="c1"># Process a user prompt safely
</span><span class="k">def</span> <span class="nf">safe_completion</span><span class="p">(</span><span class="n">user_prompt</span><span class="p">):</span>
    <span class="c1"># Evaluate the prompt
</span>    <span class="n">evaluation</span> <span class="o">=</span> <span class="n">wafishield</span><span class="p">.</span><span class="n">evaluate_prompt</span><span class="p">(</span><span class="n">user_prompt</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">evaluation</span><span class="p">[</span><span class="s">"is_safe"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"error"</span><span class="p">:</span> <span class="s">"Prompt was blocked"</span><span class="p">,</span> <span class="s">"violations"</span><span class="p">:</span> <span class="n">evaluation</span><span class="p">[</span><span class="s">"rule_violations"</span><span class="p">]}</span>
    
    <span class="c1"># Use sanitized prompt
</span>    <span class="n">sanitized_prompt</span> <span class="o">=</span> <span class="n">evaluation</span><span class="p">[</span><span class="s">"sanitized_prompt"</span><span class="p">]</span>
    
    <span class="c1"># Call OpenAI with sanitized prompt
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">openai</span><span class="p">.</span><span class="n">ChatCompletion</span><span class="p">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s">"gpt-4"</span><span class="p">,</span>
        <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span> <span class="s">"content"</span><span class="p">:</span> <span class="n">sanitized_prompt</span><span class="p">}]</span>
    <span class="p">)</span>
    
    <span class="c1"># Get response text
</span>    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">message</span><span class="p">.</span><span class="n">content</span>
    
    <span class="c1"># Evaluate the response
</span>    <span class="n">response_eval</span> <span class="o">=</span> <span class="n">wafishield</span><span class="p">.</span><span class="n">evaluate_response</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">response_eval</span><span class="p">[</span><span class="s">"is_safe"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"error"</span><span class="p">:</span> <span class="s">"Response was blocked"</span><span class="p">,</span> <span class="s">"violations"</span><span class="p">:</span> <span class="n">response_eval</span><span class="p">[</span><span class="s">"rule_violations"</span><span class="p">]}</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s">"response"</span><span class="p">:</span> <span class="n">response_eval</span><span class="p">[</span><span class="s">"sanitized_response"</span><span class="p">]}</span>

<span class="c1"># Example usage
</span><span class="n">result</span> <span class="o">=</span> <span class="n">safe_completion</span><span class="p">(</span><span class="s">"Tell me about machine learning"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">"response"</span><span class="p">])</span>
</code></pre></div></div>

<h2 id="data-flow">Data Flow</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                         ┌─────────────────┐
                         │                 │
                         │  Client Input   │
                         │                 │
                         └────────┬────────┘
                                  │
                                  ▼
                         ┌─────────────────┐
                         │  Rules Engine   │◄───────┐
                         │  (Block/Allow)  │        │
                         └────────┬────────┘        │
                                  │                 │ If rules violated,
                                  │ If rules pass   │ request is blocked
                                  ▼                 │
                         ┌─────────────────┐        │
                         │   Sanitizer     │────────┘
                         │    Engine       │
                         └────────┬────────┘
                                  │
                                  │ Sanitized prompt
                                  ▼
                         ┌─────────────────┐
                         │ LLM Evaluator   │
                         │(Security Check) │
                         └────────┬────────┘
                                  │
                                  │ If all checks pass
                                  ▼
                         ┌─────────────────┐
                         │                 │
                         │   LLM Service   │
                         │                 │
                         └────────┬────────┘
                                  │
                                  ▼
                         ┌─────────────────┐
                         │                 │
                         │  LLM Response   │
                         │                 │
                         └────────┬────────┘
                                  │
                                  ▼
                         ┌─────────────────┐
                         │  Rules Engine   │◄───────┐
                         │  (Block/Allow)  │        │
                         └────────┬────────┘        │
                                  │                 │ If rules violated,
                                  │ If rules pass   │ response is blocked
                                  ▼                 │
                         ┌─────────────────┐        │
                         │   Sanitizer     │────────┘
                         │    Engine       │
                         └────────┬────────┘
                                  │
                                  ├───────────────┐
                                  │               │
                                  │               │ If sanitization
                                  │               │ patterns matched
                                  │               │
                                  │               ▼
           If no sanitization     │        ┌──────────────┐
           patterns matched       │        │ Skip LLM     │
                                  │        │ Evaluation   │
                                  ▼        └──────┬───────┘
                         ┌─────────────────┐      │
                         │ LLM Evaluator   │      │
                         │(Security Check) │      │
                         └────────┬────────┘      │
                                  │               │
                                  └───────────────┘
                                  │
                                  ▼
                         ┌─────────────────┐
                         │                 │
                         │     Client      │
                         │                 │
                         └─────────────────┘
</code></pre></div></div>

<h2 id="documentation">Documentation</h2>

<h3 id="custom-rules">Custom Rules</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Register a custom rule
</span><span class="n">wafishield</span><span class="p">.</span><span class="n">register_rule</span><span class="p">({</span>
    <span class="s">"id"</span><span class="p">:</span> <span class="s">"PROPRIETARY"</span><span class="p">,</span>
    <span class="s">"description"</span><span class="p">:</span> <span class="s">"Block prompts containing company-specific terms"</span><span class="p">,</span>
    <span class="s">"type"</span><span class="p">:</span> <span class="s">"blacklist"</span><span class="p">,</span>
    <span class="s">"pattern"</span><span class="p">:</span> <span class="sa">r</span><span class="s">"(SecretProjectName|InternalCodeword)"</span><span class="p">,</span>
    <span class="s">"action"</span><span class="p">:</span> <span class="s">"deny"</span><span class="p">,</span>
    <span class="s">"enabled"</span><span class="p">:</span> <span class="bp">True</span>
<span class="p">})</span>

<span class="c1"># Register a callback for an existing rule
</span><span class="k">def</span> <span class="nf">custom_rule_handler</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Rule </span><span class="si">{</span><span class="n">rule</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span><span class="si">}</span><span class="s"> triggered by: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="c1"># Log to security system, etc.
</span>    <span class="k">return</span> <span class="p">{</span><span class="s">"continue_evaluation"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>  <span class="c1"># Allow further processing
</span>
<span class="n">wafishield</span><span class="p">.</span><span class="n">register_rule</span><span class="p">(</span><span class="s">"LLM01"</span><span class="p">,</span> <span class="n">custom_rule_handler</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="custom-sanitization-patterns">Custom Sanitization Patterns</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Register a custom sanitization pattern
</span><span class="n">wafishield</span><span class="p">.</span><span class="n">register_sanitizer_pattern</span><span class="p">({</span>
    <span class="s">"id"</span><span class="p">:</span> <span class="s">"CUSTOM_PATTERN"</span><span class="p">,</span>
    <span class="s">"description"</span><span class="p">:</span> <span class="s">"Redact internal product names"</span><span class="p">,</span>
    <span class="s">"type"</span><span class="p">:</span> <span class="s">"regex"</span><span class="p">,</span>
    <span class="s">"pattern"</span><span class="p">:</span> <span class="sa">r</span><span class="s">"Product (Alpha|Beta|Gamma)"</span><span class="p">,</span>
    <span class="s">"replacement"</span><span class="p">:</span> <span class="s">"[INTERNAL_PRODUCT]"</span><span class="p">,</span>
    <span class="s">"action"</span><span class="p">:</span> <span class="s">"redact"</span><span class="p">,</span>
    <span class="s">"enabled"</span><span class="p">:</span> <span class="bp">True</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="custom-llm-evaluator-instructions">Custom LLM Evaluator Instructions</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Register custom system instructions for the secondary LLM evaluator
</span><span class="n">wafishield</span><span class="p">.</span><span class="n">register_system_instruction</span><span class="p">(</span>
    <span class="s">"NO_PII"</span><span class="p">,</span> 
    <span class="s">"Do not allow any personally identifiable information in the response."</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="api-reference">API Reference</h2>

<ul>
  <li><a href="api/wafishield.html">WAFIShield Class</a></li>
  <li><a href="api/rules_engine.html">Rules Engine</a></li>
  <li><a href="api/sanitizer_engine.html">Sanitizer Engine</a></li>
  <li><a href="api/llm_evaluator.html">LLM Evaluator</a></li>
  <li><a href="api/metrics.html">Metrics Collector</a></li>
</ul>

<h2 id="contributing">Contributing</h2>

<p>Contributions are welcome! Please check out our <a href="contributing.html">contribution guidelines</a>.</p>

<h2 id="license">License</h2>

<p>WAFIShield is available under the <a href="license.html">MIT License</a>.</p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/duestack/wafishield">wafishield</a> is maintained by <a href="https://github.com/duestack">duestack</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>
